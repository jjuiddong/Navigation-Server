<!DOCTYPE html>
<html
    xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>

	<link rel="stylesheet" type="text/css" href="semantic/semantic.css">
	<script
	  src="assets/library/jquery.min.js"
	  ></script>
	<script src="semantic/semantic.js"></script>
	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=685fb6d52e9558eb55705c0b663c66bd&libraries=services,clusterer,drawing"></script>

<meta charset="UTF-8">
<title>Navigation Web</title>

    <style>
        .column {
            border: 1px solid gray;
            text-align : center;
        }
        h1,h2 {
        	text-align : center;
        }
    </style>
    
</head>

<body>

<div class="ui large fixed menu">
  <div class="item">
    <img src="https://semantic-ui.com/images/logo.png">
  </div>
  <a class="active item">
    Journey
  </a>
  <a class="item" th:href="@{live}">
    Live Journey!
  </a>
  <div class="right menu">
    <div class="item">
        <div class="ui primary button">Sign Up</div>
    </div>
  </div>
</div>

<h3>~ welcome navi web ~</h3>
	
<div class="ui vertical segment" style="padding:0px;">
<div id="map" style="width:1000px;height:500px;text-align:center;"></div>
	<script th:inline="javascript">
		var container = document.getElementById('map');
		var options = {
			center: new kakao.maps.LatLng(36.450701, 126.570667),
			level: 13
		};

		var map = new kakao.maps.Map(container, options);
		var polylines = new Map();
		

		// journey checkbox clicked
		function checkClick(journeyId, journeyTimeId) {

		    var journeys =/*[[${journeys}]]*/null;  // mapping from thymeleaf
			var chkIdx = 0;
			var i = 0;
			for (i=0; i < journeys.length; ++i)
			{
				if (journeys[i].id == journeyId)
				{
					chkIdx = i;
					break;
				}			
			}
			
			var chkbox = document.getElementsByName('showChk');
			if (chkbox[chkIdx].checked)
			{
				if (polylines.has(journeyTimeId) == true)
				{
					polylines.get(journeyTimeId).setMap(map);
				}
				else
				{
					var xmlHttp = new XMLHttpRequest();
				   	xmlHttp.onreadystatechange = function() 
				   	{ 
				        if (xmlHttp.readyState == 4 && xmlHttp.status == 200) 
				        {				
				        	var data = JSON.parse(this.responseText);
							var linePath = [];
				            var i;
				            for(i = 0; i < data.length; i++) 
				            	linePath[i] = new kakao.maps.LatLng(data[i].lat, data[i].lon);
	
				    		var polyline = new kakao.maps.Polyline({
				    		    path: linePath,
				    		    strokeWeight: 5,
				    		    strokeColor: '#FF0000',
				    		    strokeOpacity: 0.7,
				    		    strokeStyle: 'solid'
				    		});
				    		
				    		polyline.setMap(map);
				    		polylines.set(journeyTimeId, polyline);				    		
				    		//var distance = Math.round(polyline.getLength());
				    		//alert(distance);				    		
				        }
				    }
					xmlHttp.open("GET", "/path/" + journeyId + '/' + journeyTimeId, true);
					xmlHttp.send(null);			   	
				}				
			}
			else
			{
				if (polylines.has(journeyTimeId) == true)
				{
					polylines.get(journeyTimeId).setMap(null);
					polylines.delete(journeyTimeId);				
				}
			}			
		}
		
	</script>
</div>

<div class="ui vertical segment" style="padding:3px; text-align:left;">
	<div class="ui animated orange button" tabindex="0" onclick="location.href='live'">
	  <div class="visible content">Live Today Journey!</div>
	  <div class="hidden content">
	    <i class="right arrow icon"></i>
	  </div>
	</div>
</div>

<div class="ui vertical segment" style="padding:0px;">

	<div id="list" style="width:1000px;">	
		<table class="ui celled striped table">
		  <thead>
		    <tr><th>Show</th>
		    <th>Number</th>
		    <th>Date</th>
		    <th>User</th>
		    <th>Distance</th>
		    <th>Journey Time</th>
		  </tr></thead>
		  
		  <tbody th:each="journey : ${journeys}">
		    <tr class="center aligned">
		      <td class="collapsing">
		        <div class="ui fitted slider checkbox">
		          <input type="checkbox" name="showChk"
		          	th:onclick="|javascript:checkClick('${journey.id}','${journey.timeId}')|"></input><label></label>
		        </div>
		      </td>
	      	    
		      <td data-label="Number" th:text="${journey.id}"></td>
		      <td data-label="Date" th:text="${journey.date}"></td>
		      <td data-label="User" th:text="${journey.userId}"></td>
		      <td data-label="Distance" th:text="|${#numbers.formatDecimal(journey.distance/1000,1,1)} Km|"></td>
		      <td data-label="Journey Time"
		       	th:text="|${#numbers.formatDecimal(journey.journeyTime/(1000*60*60),1,1)} Hour|"></td>
		    </tr>
		  </tbody>
	
		  <tfoot>
		    <tr><th colspan="6">
			<div class="ui right floated pagination menu"		
				th:with="step = 5, left=${pageNumbers[0] - step}, right=${pageNumbers[0] + step}">
				
			 	<a class="icon item" th:href="@{/pathPage(size=${page.size}, page=${left})}">
		          <i class="left chevron icon"></i>
		        </a>
		        
		        <th:block th:each="pageNumber : ${pageNumbers}">
				    <a 	th:class="${pageNumber==page.number + 1} ? 'item active' : 'item'"
				    	th:href="@{/pathPage(size=${page.size}, page=${pageNumber})}"
				        th:text=${pageNumber}>
			        </a>
		        </th:block>
		        
		        <a class="icon item" th:href="@{/pathPage(size=${page.size}, page=${right})}">
		          <i class="right chevron icon"></i>
		        </a>
			</div>	  
		  </tr></tfoot>
		  
	
		</table>
	</div>

</div>
<div class="ui vertical segment">
  <p></p>
</div>





<!-- 
	<div class="ui centered grid">
		<div class="eight column row">  Hello NaviWebServer  </div>
		<div class="one wide column">Number</div>
		<div class="three wide column">Date</div>
		<div class="three wide column">User</div>
		<div class="three wide column">Distance</div>
		<div class="three wide column">Journey Time</div>
	</div>
	
	<div class="ui centered grid" th:each="journey : ${journeys}">	
		<div class="one wide column" th:text="${journey.id}"></div>
		<div class="three wide column" th:text="${journey.date}"></div>
		<div class="three wide column" th:text="${journey.userName}"></div>
		<div class="three wide column" th:text="${journey.distance}"></div>
		<div class="three wide column" th:text="${journey.journeyTime}"></div>		
	</div>	
 -->	


</body>
</html>
